<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 0.34.0">
<meta name="crystal_docs.project_version" content="HEAD">
<meta name="crystal_docs.project_name" content="pdns">


<link href="css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/doc.js"></script>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>

  <meta id="repository-name" content="pdns">
  <title>pdns HEAD</title>
  <script type="text/javascript">
  CrystalDocs.base_path = "";
  </script>
</head>
<body>

<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="index.html">
          pdns
        </a>
      </h1>

      <span class="project-version">
        HEAD
      </span>
    </div>
  </div>

  <div class="search-results" class="hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent " data-id="pdns/Pdns" data-name="pdns">
      <a href="Pdns.html">Pdns</a>
      
        <ul>
  
  <li class="parent " data-id="pdns/Pdns/API" data-name="pdns::api">
      <a href="Pdns/API.html">API</a>
      
        <ul>
  
  <li class=" " data-id="pdns/Pdns/API/Endpoint" data-name="pdns::api::endpoint">
      <a href="Pdns/API/Endpoint.html">Endpoint</a>
      
    </li>
  
  <li class="parent " data-id="pdns/Pdns/API/Endpoints" data-name="pdns::api::endpoints">
      <a href="Pdns/API/Endpoints.html">Endpoints</a>
      
        <ul>
  
  <li class=" " data-id="pdns/Pdns/API/Endpoints/Cache" data-name="pdns::api::endpoints::cache">
      <a href="Pdns/API/Endpoints/Cache.html">Cache</a>
      
    </li>
  
  <li class=" " data-id="pdns/Pdns/API/Endpoints/Cryptokeys" data-name="pdns::api::endpoints::cryptokeys">
      <a href="Pdns/API/Endpoints/Cryptokeys.html">Cryptokeys</a>
      
    </li>
  
  <li class=" " data-id="pdns/Pdns/API/Endpoints/Metadata" data-name="pdns::api::endpoints::metadata">
      <a href="Pdns/API/Endpoints/Metadata.html">Metadata</a>
      
    </li>
  
  <li class=" " data-id="pdns/Pdns/API/Endpoints/Searching" data-name="pdns::api::endpoints::searching">
      <a href="Pdns/API/Endpoints/Searching.html">Searching</a>
      
    </li>
  
  <li class="parent " data-id="pdns/Pdns/API/Endpoints/Servers" data-name="pdns::api::endpoints::servers">
      <a href="Pdns/API/Endpoints/Servers.html">Servers</a>
      
        <ul>
  
  <li class=" " data-id="pdns/Pdns/API/Endpoints/Servers/Scoped" data-name="pdns::api::endpoints::servers::scoped">
      <a href="Pdns/API/Endpoints/Servers/Scoped.html">Scoped</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="pdns/Pdns/API/Endpoints/Statistics" data-name="pdns::api::endpoints::statistics">
      <a href="Pdns/API/Endpoints/Statistics.html">Statistics</a>
      
    </li>
  
  <li class=" " data-id="pdns/Pdns/API/Endpoints/TSIGKeys" data-name="pdns::api::endpoints::tsigkeys">
      <a href="Pdns/API/Endpoints/TSIGKeys.html">TSIGKeys</a>
      
    </li>
  
  <li class="parent " data-id="pdns/Pdns/API/Endpoints/Zones" data-name="pdns::api::endpoints::zones">
      <a href="Pdns/API/Endpoints/Zones.html">Zones</a>
      
        <ul>
  
  <li class=" " data-id="pdns/Pdns/API/Endpoints/Zones/Scoped" data-name="pdns::api::endpoints::zones::scoped">
      <a href="Pdns/API/Endpoints/Zones/Scoped.html">Scoped</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="pdns/Pdns/CacheFlushResult" data-name="pdns::cacheflushresult">
      <a href="Pdns/CacheFlushResult.html">CacheFlushResult</a>
      
    </li>
  
  <li class=" " data-id="pdns/Pdns/Comment" data-name="pdns::comment">
      <a href="Pdns/Comment.html">Comment</a>
      
    </li>
  
  <li class=" " data-id="pdns/Pdns/Cryptokey" data-name="pdns::cryptokey">
      <a href="Pdns/Cryptokey.html">Cryptokey</a>
      
    </li>
  
  <li class=" " data-id="pdns/Pdns/DNSRecordType" data-name="pdns::dnsrecordtype">
      <a href="Pdns/DNSRecordType.html">DNSRecordType</a>
      
    </li>
  
  <li class=" " data-id="pdns/Pdns/MapStatisticItem" data-name="pdns::mapstatisticitem">
      <a href="Pdns/MapStatisticItem.html">MapStatisticItem</a>
      
    </li>
  
  <li class=" " data-id="pdns/Pdns/Metadata" data-name="pdns::metadata">
      <a href="Pdns/Metadata.html">Metadata</a>
      
    </li>
  
  <li class=" " data-id="pdns/Pdns/Record" data-name="pdns::record">
      <a href="Pdns/Record.html">Record</a>
      
    </li>
  
  <li class=" " data-id="pdns/Pdns/RingStatisticItem" data-name="pdns::ringstatisticitem">
      <a href="Pdns/RingStatisticItem.html">RingStatisticItem</a>
      
    </li>
  
  <li class="parent " data-id="pdns/Pdns/RRSet" data-name="pdns::rrset">
      <a href="Pdns/RRSet.html">RRSet</a>
      
        <ul>
  
  <li class=" " data-id="pdns/Pdns/RRSet/ChangeType" data-name="pdns::rrset::changetype">
      <a href="Pdns/RRSet/ChangeType.html">ChangeType</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="pdns/Pdns/SearchResult" data-name="pdns::searchresult">
      <a href="Pdns/SearchResult.html">SearchResult</a>
      
        <ul>
  
  <li class=" " data-id="pdns/Pdns/SearchResult/ObjectType" data-name="pdns::searchresult::objecttype">
      <a href="Pdns/SearchResult/ObjectType.html">ObjectType</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="pdns/Pdns/Server" data-name="pdns::server">
      <a href="Pdns/Server.html">Server</a>
      
    </li>
  
  <li class=" " data-id="pdns/Pdns/SimpleStatisticItem" data-name="pdns::simplestatisticitem">
      <a href="Pdns/SimpleStatisticItem.html">SimpleStatisticItem</a>
      
    </li>
  
  <li class=" " data-id="pdns/Pdns/StatisticItem" data-name="pdns::statisticitem">
      <a href="Pdns/StatisticItem.html">StatisticItem</a>
      
    </li>
  
  <li class=" " data-id="pdns/Pdns/TSIGKey" data-name="pdns::tsigkey">
      <a href="Pdns/TSIGKey.html">TSIGKey</a>
      
    </li>
  
  <li class="parent " data-id="pdns/Pdns/Zone" data-name="pdns::zone">
      <a href="Pdns/Zone.html">Zone</a>
      
        <ul>
  
  <li class=" " data-id="pdns/Pdns/Zone/Kind" data-name="pdns::zone::kind">
      <a href="Pdns/Zone/Kind.html">Kind</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1><a id="pdns.cr" class="anchor" href="#pdns.cr">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>pdns.cr</h1>

<p>pdns.cr provides a crystal api to interact with the JSON API of PowerDNS</p>

<h2><a id="installation" class="anchor" href="#installation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Installation</h2>

<ol><li>Add the dependency to your <code>shard.yml</code>:</li></ol>

<pre><code class="language-yaml">dependencies:
 pdns:
   github: repomaa/pdns</code></pre>

<ol><li>Run <code>shards install</code></li></ol>

<h2><a id="usage" class="anchor" href="#usage">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Usage</h2>

<h3><a id="creating-an-api-instance" class="anchor" href="#creating-an-api-instance">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Creating an API Instance</h3>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;pdns&quot;</span>

api <span class="o">=</span> <span class="t">Pdns</span><span class="t">::</span><span class="t">API</span>.<span class="k">new</span>(<span class="s">&quot;https://your-pdns.tld&quot;</span>, <span class="s">&quot;your-api-key&quot;</span>)</code></pre>

<h3><a id="listing-servers" class="anchor" href="#listing-servers">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Listing servers</h3>

<pre><code class="language-crystal">pp api.servers.list</code></pre>

<h3><a id="listing-zones-on-a-server" class="anchor" href="#listing-zones-on-a-server">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Listing zones on a server</h3>

<pre><code class="language-crystal">api.servers.<span class="k">with</span>(<span class="s">&quot;localhost&quot;</span>) <span class="k">do</span> <span class="o">|</span>server<span class="o">|</span>
  pp server.zones.list
<span class="k">end</span></code></pre>

<h3><a id="editing-a-zone" class="anchor" href="#editing-a-zone">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Editing a zone</h3>

<pre><code class="language-crystal">api.servers.<span class="k">with</span>(<span class="s">&quot;localhost&quot;</span>) <span class="k">do</span> <span class="o">|</span>server<span class="o">|</span>
  server.zones.edit_rrsets(<span class="s">&quot;my-domain.tld.&quot;</span>) <span class="k">do</span> <span class="o">|</span>rrsets<span class="o">|</span>
    <span class="c"># delete all CNAMEs</span>
    rrsets.<span class="k">select</span>(<span class="o">&amp;</span>.<span class="k">type</span>.cname?).each(<span class="o">&amp;</span>.delete!)

    <span class="c"># modify a resource record set</span>
    rrset <span class="o">=</span> rrsets.find <span class="k">do</span> <span class="o">|</span>rrset<span class="o">|</span>
      rrset.<span class="k">type</span>.a? && rrset.name <span class="o">==</span> <span class="s">&quot;www.my-domain.tld.&quot;</span>
    <span class="k">end</span>

    raise <span class="s">&quot;No such A record&quot;</span> <span class="k">if</span> rrset.<span class="k">nil?</span>

    rrset.records <span class="o">=</span> [<span class="t">Pdns</span><span class="t">::</span><span class="t">Record</span>.<span class="k">new</span>(<span class="s">&quot;127.0.0.1&quot;</span>)]
    rrset.replace!

    <span class="c"># add a record</span>
    rrsets <span class="o">&lt;&lt;</span> <span class="t">Pdns</span><span class="t">::</span><span class="t">RRSet</span>.<span class="k">new</span>(
      name: <span class="s">&quot;www.my-domain.tld.&quot;</span>,
      <span class="k">type</span>: <span class="t">Pdns</span><span class="t">::</span><span class="t">DNSRecordType</span><span class="t">::</span><span class="t">AAAA</span>,
      ttl: <span class="n">3600_u32</span>,
      records: [<span class="t">Pdns</span><span class="t">::</span><span class="t">Record</span>.<span class="k">new</span>(<span class="s">&quot;::1&quot;</span>)],
    )
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<h3><a id="listing-cryptokeys-in-a-zone-on-a-server" class="anchor" href="#listing-cryptokeys-in-a-zone-on-a-server">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Listing cryptokeys in a zone on a server</h3>

<pre><code class="language-crystal">api.servers.<span class="k">with</span>(<span class="s">&quot;localhost&quot;</span>) <span class="k">do</span> <span class="o">|</span>server<span class="o">|</span>
  server.zones.<span class="k">with</span>(<span class="s">&quot;my-domain.tld.&quot;</span>) <span class="k">do</span> <span class="o">|</span>zone<span class="o">|</span>
    zone.cryptokeys.list
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<h3><a id="adding-a-cryptokey-to-a-zone-on-a-server" class="anchor" href="#adding-a-cryptokey-to-a-zone-on-a-server">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Adding a cryptokey to a zone on a server</h3>

<pre><code class="language-crystal">api.servers.<span class="k">with</span>(<span class="s">&quot;localhost&quot;</span>) <span class="k">do</span> <span class="o">|</span>server<span class="o">|</span>
  server.zones.<span class="k">with</span>(<span class="s">&quot;my-domain.tld.&quot;</span>) <span class="k">do</span> <span class="o">|</span>zone<span class="o">|</span>
    key <span class="o">=</span> <span class="t">Pdns</span><span class="t">::</span><span class="t">Cryptokey</span>.<span class="k">new</span>(
      key_type: <span class="s">&quot;csk&quot;</span>,
      bits: <span class="n">256_u16</span>
    )
    zone.cryptokeys.create(key)
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>See <a href="https://repomaa.github.io/pdns.cr" target="_blank">the documentation</a> for more information.
Especially the <code><a href="Pdns/API/Endpoint.html">Pdns::API::Endpoint</a></code>. Most endpoints are scoped under either
<code><a href="Pdns/API/Endpoints/Servers.html">Pdns::API::Endpoints::Servers</a></code> or <code><a href="Pdns/API/Endpoints/Zones.html">Pdns::API::Endpoints::Zones</a></code> (which is in turn
scoped under <code><a href="Pdns/API/Endpoints/Servers.html">Pdns::API::Endpoints::Servers</a></code>). You can access the scoped
endpoints by using the <code>#with(id)</code> method of an endpoint. It will be passed as a
block variable.</p>

<h2><a id="contributing" class="anchor" href="#contributing">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributing</h2>

<ol><li>Fork it (&lt;https://github.com/repomaa/pdns.cr/fork>)</li><li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li><li>Commit your changes (<code>git commit -am 'Add some feature'</code>)</li><li>Push to the branch (<code>git push origin my-new-feature</code>)</li><li>Create a new Pull Request</li></ol>

<h2><a id="contributors" class="anchor" href="#contributors">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributors</h2>

<ul><li><a href="https://github.com/repomaa" target="_blank">Joakim Repomaa</a> - creator and maintainer</li></ul>
</div>
</body>
</html>
